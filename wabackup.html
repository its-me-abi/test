window.db =null;
window.DB_NAME = "model-storage";
window.OBJECT_STORE_NAME = "contact";

function openDb() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open(window.DB_NAME);

        request.onerror = (event) => {
            reject(event.target.error);
        };

        request.onsuccess = (event) => {
            db = event.target.result;
            resolve(db);
        };


        request.onupgradeneeded = (event) => {
            const db = event.target.result;

        };
    });
}


async function readAllContacts() {
    try {
        if (!db) {
            await openDb();
        }

        const transaction = db.transaction([OBJECT_STORE_NAME], 'readonly');
        const objectStore = transaction.objectStore(window.OBJECT_STORE_NAME);

        const contacts = await new Promise((resolve, reject) => {
            const getAllRequest = objectStore.getAll();
            getAllRequest.onsuccess = (event) => resolve(event.target.result);
            getAllRequest.onerror = (event) => reject(event.target.error);
        });

        console.log(contacts);
        downloadStringAsFile(JSON.stringify(contacts), "WACOntacts.json", "application/json");

    } catch (error) {
        console.error("An error occurred:", error);
    }
}


function downloadStringAsFile(dataString, filename, mimeType = 'text/plain') {

    const blob = new Blob([dataString], { type: `${mimeType};charset=utf-8;` });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.setAttribute('href', url);
    link.setAttribute('download', filename);
    link.style.visibility = 'hidden';
    link.style.position = 'absolute'; // Prevent it from affecting layout
    link.style.top = '-9999px';
    link.style.left = '-9999px';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);

    console.log(`Download initiated `);
}

readAllContacts();


